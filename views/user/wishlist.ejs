<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FitVibe - Your Wishlist</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <style>
    /* Inherit Global Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary-color: #1a1a1a;
      --secondary-color: #ffd700;
      --accent-color: #e6c200;
      --text-light: #ffffff;
      --text-dark: #333333;
      --background-light: #f9f9f9;
      --card-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }

    html, body {
      height: 100%;
    }

    body {
      font-family: 'Arial', sans-serif;
      line-height: 1.6;
      color: var(--text-dark);
      background-color: var(--background-light);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    main {
      flex: 1 0 auto;
    }

    footer {
      flex-shrink: 0;
    }

    /* Wishlist Section */
    .wishlist-section {
      padding: 60px 20px;
      text-align: center;
      background: var(--background-light);
    }

    .wishlist-section h2 {
      font-size: 36px;
      margin-bottom: 30px;
      color: var(--text-dark);
      position: relative;
      display: inline-block;
    }

    .wishlist-section h2::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 3px;
      background: var(--secondary-color);
    }

    .wishlist-items {
      display: flex;
      flex-direction: column;
      gap: 20px;
      max-width: 800px;
      margin: 0 auto;
    }

    .wishlist-item {
      display: flex;
      align-items: center;
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: var(--card-shadow);
      transition: var(--transition);
    }

    .wishlist-item:hover {
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    }

    .wishlist-item img {
      width: 100px;
      height: 100px;
      object-fit: cover;
      border-radius: 8px;
      margin-right: 20px;
    }

    .wishlist-item-details {
      flex: 1;
      text-align: left;
    }

    .wishlist-item-details h3 {
      font-size: 18px;
      margin-bottom: 10px;
      color: var(--text-dark);
    }

    .wishlist-item-details .price {
      font-size: 16px;
      color: #e74c3c;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .wishlist-item-details .stars {
      color: var(--secondary-color);
      margin-bottom: 10px;
      font-size: 14px;
    }

    .wishlist-item-out-of-stock {
      color: #e74c3c;
      font-size: 14px;
      font-style: italic;
    }

    .wishlist-item-actions {
      display: flex;
      gap: 10px;
    }

    .wishlist-item-actions .add-to-cart-btn {
      padding: 8px 15px;
      background: var(--secondary-color);
      color: var(--primary-color);
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: var(--transition);
    }

    .wishlist-item-actions .add-to-cart-btn:hover {
      background: var(--accent-color);
      transform: scale(1.05);
    }

    .wishlist-item-actions .add-to-cart-btn:disabled {
      background: #ccc;
      color: #666;
      cursor: not-allowed;
    }

    .wishlist-item-actions .remove-btn {
      padding: 8px 15px;
      background: #e74c3c;
      color: var(--text-light);
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: var(--transition);
    }

    .wishlist-item-actions .remove-btn:hover {
      background: #c0392b;
    }

    .empty-wishlist {
      font-size: 18px;
      color: var(--text-dark);
    }

    /* Responsive Styles */
    @media (max-width: 768px) {
      .wishlist-item {
        flex-direction: column;
        align-items: flex-start;
      }

      .wishlist-item img {
        width: 100%;
        max-width: 150px;
        margin-bottom: 10px;
      }

      .wishlist-section h2 {
        font-size: 28px;
      }

      .wishlist-item-actions {
        flex-direction: column;
        width: 100%;
      }

      .wishlist-item-actions button {
        width: 100%;
        text-align: center;
      }
    }

    @media (max-width: 480px) {
      .wishlist-section h2 {
        font-size: 24px;
      }

      .wishlist-item-details h3 {
        font-size: 16px;
      }

      .wishlist-item-details .price {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <!-- Header Partial -->
  <%- include('./partials/header') %>

  <main>
    <!-- Wishlist Section -->
    <div class="wishlist-section">
      <h2>Your Wishlist</h2>
      <% if (wishlist && wishlist.items.length > 0) { %>
        <div class="wishlist-items">
          <% wishlist.items.forEach(item => { %>
            <div class="wishlist-item">
              <img src="<%= item.product.images && item.product.images.length > 0 ? item.product.images[0].url : '/path/to/default-image.jpg' %>" alt="<%= item.product.name %>" loading="lazy" />
              <div class="wishlist-item-details">
                <h3><%= item.product.name %></h3>
                <p class="price">₹<%= item.product.variants[0].salePrice.toFixed(2) %></p>
                <div class="stars">
                  <% for(let i = 0; i < Math.floor(item.product.rating || 0); i++) { %>
                    <i class="fas fa-star"></i>
                  <% } %>
                  <% if((item.product.rating || 0) % 1 !== 0) { %>
                    <i class="fas fa-star-half-alt"></i>
                  <% } %>
                  <% for(let i = 0; i < 5 - Math.ceil(item.product.rating || 0); i++) { %>
                    <i class="far fa-star"></i>
                  <% } %>
                </div>
                <% if (item.product.variants[0].stock === 0) { %>
                  <p class="wishlist-item-out-of-stock">Out of Stock</p>
                <% } %>
              </div>
              <div class="wishlist-item-actions">
                <button class="btn btn-primary add-to-cart-btn" data-product-id="<%= item.product._id %>">
                  Add to Cart
                </button>
                <button class="remove-btn" data-product-id="<%= item.product._id %>">Remove</button>
              </div>
            </div>
          <% }) %>
        </div>
      <% } else { %>
        <p class="empty-wishlist">Your wishlist is empty.</p>
      <% } %>
    </div>
  </main>

  <!-- Footer Partial -->
  <%- include('./partials/footer') %>

  <!-- JavaScript for Wishlist Interactions -->
  <script>
  document.addEventListener('DOMContentLoaded', () => {

    // ✅ Add to cart from wishlist
    document.querySelectorAll('.add-to-cart-btn').forEach(button => {
      button.addEventListener('click', async () => {
        const productId = button.getAttribute('data-product-id');
        try {
          const response = await fetch('/wishlist/add-to-cart', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ productId })
          });
          const result = await response.json();
          if (result.success) {
            alert('Product added to cart!');
            window.location.reload();
          } else {
            alert(result.message || 'Failed to add product to cart.');
          }
        } catch (err) {
          console.error('Error:', err);
          alert('Error adding product to cart');
        }
      });
    });

    // ✅ Remove from Wishlist
    document.querySelectorAll('.remove-btn').forEach(button => {
      button.addEventListener('click', async () => {
        const productId = button.getAttribute('data-product-id');
        try {
          const response = await fetch('/wishlist/remove', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ productId })
          });
          if (response.ok) {
            window.location.reload();
          } else {
            alert('Failed to remove product from wishlist.');
          }
        } catch (error) {
          alert('Error removing product from wishlist.');
        }
      });
    });

  });
</script>
</body>
</html>